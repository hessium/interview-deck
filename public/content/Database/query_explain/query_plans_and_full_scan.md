# План запроса и полный проход по таблице (Full Table Scan)

## Описание

Этот документ посвящён анализу планов выполнения SQL-запросов с акцентом на полные сканирования таблиц (Full Table Scan). Объясняется, в каких случаях они возникают, когда являются проблемой и как их избежать.

---

## Вопросы и ответы

### ❓ Что такое Full Table Scan?

**Full Table Scan** — это стратегия выполнения запроса, при которой СУБД читает **все строки** в таблице, чтобы найти подходящие под условие WHERE или JOIN.

---

### ❓ Когда возникает полный проход по таблице?

Полный скан происходит в случаях:

- Нет подходящего индекса.
- Запрос не может использовать индекс (например, функция в WHERE).
- Планировщик считает, что выборка охватывает большую часть таблицы.
- Таблица слишком маленькая — дешевле прочитать её целиком, чем использовать индекс.

---

### ❓ Почему Full Table Scan может быть проблемой?

Проблемы:

- Большая нагрузка на диск (особенно при чтении с HDD).
- Высокое время ответа на запрос.
- Неэффективное использование ресурсов CPU и памяти.

Особенно критично на больших таблицах (миллионы+ строк).

---

### ❓ Когда Full Table Scan — это нормально?

Полный проход может быть **оптимальной стратегией** в случаях:

- Таблица очень маленькая.
- WHERE-условие не фильтрует строки (или фильтрует почти все).
- Индексы не помогают (например, поиск по колонке с плохой селективностью).

---

### ❓ Как выявить Full Table Scan?

Используйте `EXPLAIN` или `EXPLAIN ANALYZE`. Ищите в плане шаги вида:
```
Seq Scan on table_name ...
```

---

### ❓ Как избежать полного сканирования таблицы?

1. Создайте индекс на фильтруемое поле.
2. Не используйте функции в WHERE, которые блокируют использование индекса.
3. Следите за статистикой с помощью `ANALYZE`.
4. Используйте `SET enable_seqscan = off;` (только для диагностики — не используйте в проде).

---

### ❓ Пример

```sql
EXPLAIN SELECT * FROM orders WHERE status = 'completed';
```

Если нет индекса по `status`, план покажет:

```
Seq Scan on orders  (cost=0.00..1835.00 rows=50000 width=64)
```

После добавления индекса:

```sql
CREATE INDEX idx_orders_status ON orders(status);
```

Повторный `EXPLAIN` даст:

```
Index Scan using idx_orders_status on orders ...
```

---

## Рекомендации

- Анализируйте планы выполнения регулярно.
- Используйте индексы разумно.
- Следите за selectivity и статистикой по колонкам.

