# –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ C++, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –¥—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## –í–æ–ø—Ä–æ—Å—ã –ø–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –∫–æ–¥–∞
### 1. –î–ª—è —á–µ–≥–æ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç ThreadSanitizer?
**ThreadSanitizer (TSan)** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å—Ç–∞—Ç–∏–∫–æ-–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ C/C++** 
(–∏ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä Go). 
–û–Ω –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –≤ —Å–ª–æ–∂–Ω—ã—Ö –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –≥–¥–µ –æ—à–∏–±–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç—Ä—É–¥–Ω–æ—É–ª–æ–≤–∏–º—ã–º–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –Ω–µ –≤—Å–µ–≥–¥–∞.

| –ü—Ä–æ–±–ª–µ–º–∞     | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ  |
|----------------------|-------------|
| Data race    | –ö–æ–≥–¥–∞ –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑ –æ–±—Ä–∞—â–µ–Ω–∏–π ‚Äî –∑–∞–ø–∏—Å—å, **–±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.**  |
| Use-after-free (–≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ)     | –û–¥–∏–Ω –ø–æ—Ç–æ–∫ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, –¥—Ä—É–≥–æ–π ‚Äî –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç.   |
| Deadlocks (—á–∞—Å—Ç–∏—á–Ω–æ)     | –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.  |

### 2. –î–ª—è —á–µ–≥–æ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç AddressSanitizer?
AddressSanitizer (ASan) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ clang –∏ gcc, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
- Use-after-free
- Stack/heap overflows

## –í–æ–ø—Ä–æ—Å—ã –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–∞–º—è—Ç–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ–∫ (stack)?
**–°—Ç–µ–∫** ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö,
- –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏,
- –∞–¥—Ä–µ—Å–æ–≤ –≤–æ–∑–≤—Ä–∞—Ç–∞,
- –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –∏ –∫–∞–¥—Ä–æ–≤ –≤—ã–∑–æ–≤–∞)

**–ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ —Å—Ç–µ–∫–µ?**
–ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ **—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞ (stack pointer)**

–ù–∞ –Ω–æ–≤–æ–º —É—á–∞—Å—Ç–∫–µ –ø–∞–º—è—Ç–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è:
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏,
- –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ,
- –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞.

–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ rsp –ø—Ä–æ—Å—Ç–æ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥ ‚Äî –∏ —Å—Ç–µ–∫ "–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è".

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—É—á–∞ (heap)?
**–ö—É—á–∞** ‚Äî —ç—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π **–º–æ–∂–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å –≤—Ä—É—á–Ω—É—é**.

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `malloc/free` –≤ C, `new/delete` –≤ C++, `std::make_shared`, `std::vector` –∏ —Ç.–ø.
- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–µ –∏ –∑–∞–Ω—è—Ç—ã–µ –±–ª–æ–∫–∏.

**–ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫—É—á–µ?**

- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `malloc(size)` –∏–ª–∏ `new Type(...)`
- –ê–ª–ª–æ–∫–∞—Ç–æ—Ä –∏—â–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π –±–ª–æ–∫, –ø–æ–º–µ—á–∞–µ—Ç –µ–≥–æ –∫–∞–∫ –∑–∞–Ω—è—Ç—ã–π, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å.
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—Ä—É—á–Ω—É—é `(free, delete)` –∏–ª–∏ —á–µ—Ä–µ–∑ **RAII** (`std::unique_ptr, std::vector` –∏ —Ç.–ø.).

## –í–æ–ø—Ä–æ—Å—ã –ø–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º

### –ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ –≤—ã–ø—É—Å—Ç–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ–º–µ—á–µ–Ω–Ω–æ–π noexcept?
–ï—Å–ª–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π –∫–∞–∫ `noexcept`, –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤** `std::terminate()`, –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.
```c++
void foo() noexcept {
    throw std::runtime_error("error");  // std::terminate –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω
}
```

**–í–∞–∂–Ω–æ**: `noexcept` ‚Äî —ç—Ç–æ –æ–±–µ—â–∞–Ω–∏–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –ù–∞—Ä—É—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ ‚Äî —Ñ–∞—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## –ö–∞—Å—Ç–∏–Ω–≥ –∑–Ω–∞—á–µ–Ω–∏–π

`dynamic_cast` 
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RTTI –∏ —Ç–∞–±–ª–∏—Ü—ã vtable –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞. 
- –ë–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, vtable) `dynamic_cast` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

### –û—Ç–ª–∏—á–∏–µ static_cast –∏ reinterpret_cast

`static_cast<T>(expr)`
- –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º `reinterpret_cast`;
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏;

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —á–∏—Å–ª–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ (int ‚Üí float);
- **–≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ/–Ω–∏—Å—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è** –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–ª–∞—Å—Å–æ–≤ (–±–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞);
- –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π **–º–µ–∂–¥—É —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏**;
- –≤—ã–∑–æ–≤–∞ **—è–≤–Ω–æ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞**.
```c++
double d = 3.14;
int i = static_cast<int>(d);  // OK
```

`reinterpret_cast<T>(expr)`
- –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –±–∏—Ç–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤ –¥—Ä—É–≥–æ–π; 
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º;

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤;
- —Ä–∞–±–æ—Ç—ã —Å raw memory, –∫–∞—Å—Ç–æ–≤ –∫ `uintptr_t`, `void*`;
- —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —á—Ç–µ–Ω–∏—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.

```c++
int i = 0x3f800000; // –±–∏—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ float 1.0
float f = *reinterpret_cast<float*>(&i);
```

---

## –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ

### –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ volatile?

`volatile` –≥–æ–≤–æ—Ä–∏—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É: –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, 
—Ç.–∫. –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è **–≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä,
–∏–∑–º–µ–Ω–µ–Ω–æ –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–æ–º, —Å–∏–≥–Ω–∞–ª–æ–º, ISR (interrupt service routine), –∏–ª–∏ –∏–∑ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.
```c++
volatile bool stop = false;

void thread_loop() {
    while (!stop) {
        // do something
    }
}
```
–ë–µ–∑ `volatile`, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å stop –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–∏–Ω —Ä–∞–∑ ‚Äî –∏ –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞.
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ **–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –ø–∞–º—è—Ç–∏ –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```c++
volatile int* uart_register = reinterpret_cast<volatile int*>(0xDEADBEEF);
*uart_register = 0x01;
```
–ï—Å–ª–∏ **–Ω–µ —É–∫–∞–∑–∞—Ç—å volatile**, —Ç–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É `0xDEADBEEF` 
‚Äî –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã **—Å—Ç–∞–Ω–µ—Ç –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º**.

**–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç:**
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ –∏ –Ω–µ —á–∏—Ç–∞—Ç—å –ø–∞–º—è—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ;
- –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –≤–æ–æ–±—â–µ, –µ—Å–ª–∏ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –æ–Ω–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã (¬´–º–µ—Ä—Ç–≤—ã–π –∫–æ–¥¬ª).


### –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ mutable?

`mutable` –ø–æ–∑–≤–æ–ª—è–µ—Ç **–∏–∑–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –¥–∞–∂–µ –≤** `const` **–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ**, —Ç–æ –µ—Å—Ç—å –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è 
–æ–±—ä–µ–∫—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∞ –∫–∞–∫ `const`, –∏–ª–∏ –º–µ—Ç–æ–¥ –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ `const`.

```c++
class Timer {
    mutable int call_count = 0;

public:
    void log() const {
        ++call_count; // –¥–æ–ø—É—Å—Ç–∏–º–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–ª–µ mutable
    }
};
```
–ó–¥–µ—Å—å `log() ‚Äî const`, –Ω–æ `call_count` –≤—Å—ë —Ä–∞–≤–Ω–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å.

**–ö–æ–≥–¥–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–Ω—É—Ç—Ä–∏ const –º–µ—Ç–æ–¥–∞; 
- –í–µ–¥–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤, –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏; 
- –õ—é–±–∞—è —Å–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–µ –≤–ª–∏—è—é—â–∞—è –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è–º–∏:**

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ C++ **–∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ –ª—è–º–±–¥—ã –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å**, 
—Ç–∞–∫ –∫–∞–∫ `operator()` —É –ª—è–º–±–¥—ã ‚Äî `const`.

–ó–¥–µ—Å—å `mutable` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∫–æ–ø–∏–∏ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ —Ç–µ–ª–∞ –ª—è–º–±–¥—ã. 
–ë–µ–∑ `mutable` –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –¥–∞—Å—Ç –∏–∑–º–µ–Ω–∏—Ç—å **x**.

### –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ explicit

–ó–∞–ø—Ä–µ—â–∞–µ—Ç **–Ω–µ—è–≤–Ω–æ–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∏–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. 
–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è **—Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –±–∞–≥–∞–º.
```c++
struct MyClass {
    explicit MyClass(int x) { }
};

void foo(MyClass obj) {}

foo(10);  // ‚ùå –æ—à–∏–±–∫–∞: —Ç—Ä–µ–±—É–µ—Ç—Å—è MyClass, –Ω–µ int
foo(MyClass(10));  // ‚úÖ —è–≤–Ω—ã–π –≤—ã–∑–æ–≤
```

---

## –í–æ–ø—Ä–æ—Å—ã –ø–æ —Å—Ç—Ä–æ–∫–∞–º

### –ß—Ç–æ —Ç–∞–∫–æ–µ UTF-8?

**UTF-8** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª—ã (–±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –∑–Ω–∞–∫–∏ –∏ –¥–∞–∂–µ —Å–º–∞–π–ª–∏–∫–∏) –≤ **–±–∞–π—Ç—ã**. 
–û–Ω –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Å–µ–º–µ–π—Å—Ç–≤—É **Unicode** ‚Äî —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è –¥–∞—ë—Ç –∫–∞–∂–¥–æ–º—É —Å–∏–º–≤–æ–ª—É –≤ –º–∏—Ä–µ —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä (–∫–æ–¥–æ–≤—É—é —Ç–æ—á–∫—É).

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ UTF-8:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç 1 –¥–æ 4 –±–∞–π—Ç –Ω–∞ —Å–∏–º–≤–æ–ª.
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å ASCII (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç, —Ü–∏—Ñ—Ä—ã –∏ –±–∞–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –∑–∞–Ω–∏–º–∞—é—Ç 1 –±–∞–π—Ç).
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —è–∑—ã–∫–∏ –º–∏—Ä–∞, –≤–∫–ª—é—á–∞—è —Ä—É—Å—Å–∫–∏–π, –∫–∏—Ç–∞–π—Å–∫–∏–π, –∞—Ä–∞–±—Å–∫–∏–π, —ç–º–æ–¥–∑–∏ –∏ –¥—Ä.

**–ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ C++?**

```c++
std::string s = "Hello";          // ASCII ‚Äî 1 –±–∞–π—Ç –Ω–∞ —Å–∏–º–≤–æ–ª
std::string r = "–ü—Ä–∏–≤–µ—Ç";         // UTF-8, 2 –±–∞–π—Ç–∞ –Ω–∞ —Å–∏–º–≤–æ–ª
std::string e = "üíñ";             // UTF-8, 4 –±–∞–π—Ç–∞ –Ω–∞ —Å–∏–º–≤–æ–ª
```

**–∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã** ‚Äî —ç—Ç–æ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ **UTF-8**, –∫–æ—Ç–æ—Ä–æ–µ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ **1 –±–∞–π—Ç** (ASCII).

–í C++ `std::string` —Ö—Ä–∞–Ω–∏—Ç **–±–∞–π—Ç—ã**, –∞ –Ω–µ —Å–∏–º–≤–æ–ª—ã. –ü–æ—ç—Ç–æ–º—É:
- `s.size()` –±—É–¥–µ—Ç 5 (5 –±—É–∫–≤ –ø–æ 1 –±–∞–π—Ç—É),
- `r.size()` –±—É–¥–µ—Ç 12 (6 –±—É–∫–≤ –ø–æ 2 –±–∞–π—Ç–∞),
- `e.size()` –±—É–¥–µ—Ç 4 (1 —Å–∏–º–≤–æ–ª üíñ, 4 –±–∞–π—Ç–∞).

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **–∏–º–µ–Ω–Ω–æ —Å–∏–º–≤–æ–ª–∞–º–∏** (–∞ –Ω–µ –±–∞–π—Ç–∞–º–∏), —Ç–µ–±–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å—Ç–æ—Ä–æ–Ω–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `utf8cpp`) 
–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `std::u32string` (—Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º 4 –±–∞–π—Ç–∞ –Ω–∞ —Å–∏–º–≤–æ–ª), –Ω–æ —ç—Ç–æ —É–∂–µ –Ω–µ UTF-8.

---

## –í–æ–ø—Ä–æ—Å—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º

### –ß—Ç–æ —Ç–∞–∫–æ–µ copy elision?

Copy elision (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è) ‚Äî —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏–∑–±–µ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.

–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?
1. –í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏:

```c++
struct A {
    A() { std::cout << "A created\n"; }
    A(const A&) { std::cout << "A copied\n"; }
};

A createA() {
    return A(); // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –Ω–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!
}

int main() {
    A obj = createA(); // –ù–∏–∫–∞–∫–∏—Ö –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–π!
}
```

**–ë–µ–∑ copy elision:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π A –≤–Ω—É—Ç—Ä–∏ createA().
- –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ obj.
**–° copy elision (RVO - Return Value Optimization):**
- obj —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ –º–µ—Å—Ç–µ –≤—ã–∑–æ–≤–∞ createA().

**–ö–æ–≥–¥–∞ copy elision –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç?**
- –ï—Å–ª–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.
```c++
A obj1;
A obj2 = obj1; // –ù–µ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è (–µ—Å–ª–∏ –Ω–µ `= default`)
```
- –ï—Å–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (A(A&&)) ‚Äî —Ç–æ–≥–¥–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –µ–≥–æ –≤—ã–∑–æ–≤–µ—Ç.
