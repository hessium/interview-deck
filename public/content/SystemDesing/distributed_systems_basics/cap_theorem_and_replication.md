# CAP-теорема, Репликация и Шардирование

## Краткое описание

CAP-теорема описывает фундаментальные ограничения распределённых систем. Репликация и шардирование — базовые техники масштабирования и повышения надёжности.

---

## Вопросы и ответы

### Что такое CAP-теорема?

**Ответ:**  
CAP — это Consistency, Availability, Partition tolerance. Согласно теореме, распределённая система не может одновременно гарантировать все три свойства.

- **Consistency** — все клиенты видят одинаковые данные в одно и то же время.
- **Availability** — система отвечает на каждый запрос (не обязательно с актуальными данными).
- **Partition tolerance** — система продолжает работать при сетевых сбоях между узлами.

**Вывод:** можно выбрать только два из трёх: CA, CP или AP. Но на практике все системы должны быть P (partition-tolerant), поэтому приходится выбирать между C и A.

---

### Какие бывают типы репликации?

- **Синхронная репликация** — мастер ждёт подтверждения от реплики перед подтверждением клиенту.
- **Асинхронная репликация** — мастер не ждёт подтверждения от реплики.
- **Гибридная (semi-sync)** — мастер ждёт хотя бы одну реплику.

---

### Какие проблемы возникают при репликации?

- **Возможна потеря данных** (при async репликации).
- **Split-brain** — два мастера в разных частях кластера.
- **Задержки репликации** — устаревшие данные на репликах.

---

### Что такое шардирование?

**Ответ:**  
Разбиение данных по независимым сегментам (шарам), каждый из которых обслуживается отдельным узлом или группой узлов. Используется для масштабирования по данным.

**Методы шардирования:**

- По диапазону (range-based)
- По хешу ключа (hash-based)
- Географическое

---

### Репликация vs Шардирование

| Свойство         | Репликация                            | Шардирование                         |
|------------------|----------------------------------------|--------------------------------------|
| Цель             | Повышение доступности и надёжности     | Масштабирование по объёму данных     |
| Типы данных      | Все узлы содержат одни и те же данные  | Данные разделены между узлами        |
| Запросы          | Могут идти на любой узел               | Направляются к нужному шару          |


