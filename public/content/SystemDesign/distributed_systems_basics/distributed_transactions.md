# Распределённые транзакции

## Краткое описание

Распределённые транзакции позволяют атомарно модифицировать состояние в нескольких независимых сервисах/базах данных. Это важно для консистентности данных в микросервисной архитектуре.

---

## Вопросы и ответы

### Какие есть подходы к реализации распределённых транзакций?

1. **2PC (Two-Phase Commit)** — классический подход:
   - Фаза подготовки: все участники говорят "готов".
   - Фаза фиксации: координатор говорит "commit" или "rollback".

   Недостатки: блокирующий алгоритм, уязвимость к сбою координатора.

2. **3PC (Three-Phase Commit)** — улучшение 2PC, добавляет фазу предварительной фиксации. Более сложен, но снижает риск блокировки.

3. **SAGA** — транзакция разбивается на серию локальных действий и компенсационных операций. Подходит для микросервисов, где нет общего координационного сервиса.

---

### Что такое SAGA?

**Ответ:**
SAGA — шаблон управления распределёнными транзакциями через чередование обычных операций и операций-откатов. Используется в долгоживущих процессах, например, в бронировании билетов или заказах.

**Подходы:**

- **Choreography** — каждый сервис сам вызывает следующий.
- **Orchestration** — один сервис-оркестратор управляет последовательностью.

---

### Проблемы распределённых транзакций

- Удержание блокировок в течение всей фазы — риск дедлоков.
- Необходимость логирования и восстановления.
- Нарушение изоляции при длительных транзакциях.
- Требуют глобального координационного сервиса или стабильной сети.

---

### Когда НЕ использовать распределённые транзакции?

- При высокой нагрузке и требованиях к latency.
- Когда можно использовать event-driven архитектуру или eventual consistency.
- Когда бизнес-логика позволяет компенсировать ошибки (например, отменить заказ).


